(function(){"use strict";BX.namespace("BX.Landing.UI.Field");var t=BX.Landing.Utils.isBoolean;var e=BX.Landing.Utils.prepend;var i=BX.Landing.Utils.remove;var n=BX.Landing.Utils.data;var s=BX.Landing.Utils.attr;var a=BX.Landing.Utils.addClass;var o=BX.Landing.Utils.removeClass;var l=BX.Landing.Utils.proxy;BX.Landing.UI.Field.LinkURL=function(n){BX.Landing.UI.Field.Text.apply(this,arguments);this.options=n.options||{};if(n.disallowType===true){a(this.layout,"landing-ui-disallow-type")}this.disableBlocks=t(n.disableBlocks)?n.disableBlocks:false;this.disableCustomURL=t(n.disableCustomURL)?n.disableCustomURL:false;this.layout.classList.add("landing-ui-field-link-url");this.button=new BX.Landing.UI.Button.BaseButton("dropdown_button",{text:BX.message("LINK_URL_SUGGESTS_SELECT"),className:"landing-ui-button-select-link",onClick:this.disableBlocks?this.onListShow.bind(this,"landings",this.options):this.onSelectButtonClick.bind(this)});this.popup=null;this.grid=BX.create("div",{props:{className:"landing-ui-field-link-url-grid"}});this.gridLeft=BX.create("div",{props:{className:"landing-ui-field-link-url-grid-left"}});this.gridCenter=BX.create("div",{props:{className:"landing-ui-field-link-url-grid-center"}});this.gridRight=BX.create("div",{props:{className:"landing-ui-field-link-url-grid-right"}});this.grid.appendChild(this.gridLeft);this.grid.appendChild(this.gridCenter);this.grid.appendChild(this.gridRight);this.gridCenter.appendChild(this.input);this.gridRight.appendChild(this.button.layout);this.layout.appendChild(this.grid);this.preparePlaceholder();this.typeDropdown=new BX.Landing.UI.Field.Dropdown({items:[{name:BX.message("LANDING_LINK_FIELD_URL_TYPE_LINK"),value:""},{name:BX.message("LANDING_LINK_FIELD_URL_TYPE_PHONE"),value:"tel:"},{name:BX.message("LANDING_LINK_FIELD_URL_TYPE_SKYPE"),value:"skype:"},{name:BX.message("LANDING_LINK_FIELD_URL_TYPE_SMS"),value:"sms:"},{name:BX.message("LANDING_LINK_FIELD_URL_TYPE_EMAIL"),value:"mailto:"}],onValueChange:this.onTypeChange.bind(this)});this.adjustValue();i(this.typeDropdown.header);e(this.typeDropdown.layout,this.gridLeft);this.editPrevented=this.disableCustomURL?n.disableCustomURL:this.getValue().indexOf("span")!==-1;this.onTypeChange(this.typeDropdown)};BX.Landing.UI.Field.LinkURL.prototype={constructor:BX.Landing.UI.Field.LinkURL,__proto__:BX.Landing.UI.Field.Text.prototype,onTypeChange:function(t){var e=t.getValue();if(e===""){n(this.input,"data-placeholder",this.placeholder||BX.message("FIELD_LINK_HREF_PLACEHOLDER"));if(this.disableBlocks&&this.disableCustomURL){s(this.input,"data-placeholder",BX.message("FIELD_LINK_HREF_PLACEHOLDER_PAGES_ONLY"))}if(!this.disableBlocks&&this.disableCustomURL){s(this.input,"data-placeholder",BX.message("FIELD_LINK_HREF_PLACEHOLDER_WITHOUT_CUSTOM_URL"))}o(this.button.layout,"landing-ui-disable");this.gridRight.removeEventListener("mouseover",l(this.onButtonMouseover,this));this.gridRight.removeEventListener("mouseout",l(this.onButtonMouseout,this));return}if(e==="tel:"){n(this.input,"data-placeholder",BX.message("LANDING_LINK_FIELD_URL_TYPE_PHONE_PLACEHOLDER"));a(this.button.layout,"landing-ui-disable")}if(e==="skype:"){n(this.input,"data-placeholder",BX.message("LANDING_LINK_FIELD_URL_TYPE_SKYPE_PLACEHOLDER"));a(this.button.layout,"landing-ui-disable")}if(e==="sms:"){n(this.input,"data-placeholder",BX.message("LANDING_LINK_FIELD_URL_TYPE_SMS_PLACEHOLDER"));a(this.button.layout,"landing-ui-disable")}if(e==="mailto:"){n(this.input,"data-placeholder",BX.message("LANDING_LINK_FIELD_URL_TYPE_EMAIL_PLACEHOLDER"));a(this.button.layout,"landing-ui-disable")}this.gridRight.addEventListener("mouseover",l(this.onButtonMouseover,this));this.gridRight.addEventListener("mouseout",l(this.onButtonMouseout,this))},onButtonMouseover:function(){this.sustomTypeSuggestTimeout=setTimeout(function(){BX.Landing.UI.Tool.Suggest.getInstance().show(this.button.layout,{description:BX.message("LANDING_LINK_FIELD_URL_TYPE_CUSTOM_BUTTON_TITLE")});this.pulseTimeout=setTimeout(function(){a(this.typeDropdown.input,"landing-ui-pulse")}.bind(this),1e3)}.bind(this),100)},onButtonMouseout:function(){clearTimeout(this.sustomTypeSuggestTimeout);BX.Landing.UI.Tool.Suggest.getInstance().hide();clearTimeout(this.pulseTimeout);o(this.typeDropdown.input,"landing-ui-pulse")},preparePlaceholder:function(){var t=new RegExp("^#landing[0-9]*");var e=new RegExp("^#block[0-9]*");var i=new RegExp("^#system_[a-z]*");if(t.test(this.content)){var n=this.content.replace("#landing","");BX.Landing.UI.Panel.URLList.getInstance().getLanding(n,this.options).then(function(t){t=t[0];if(t){this.setValue(this.createPlaceholder({type:"landing",id:t.ID,name:t.TITLE}))}}.bind(this))}if(e.test(this.content)){var s=parseInt(this.content.replace("#block",""));BX.Landing.UI.Panel.URLList.getInstance().getBlocks(null,this.options).then(function(t){t.forEach(function(t){if(s===t.id){this.setValue(this.createPlaceholder({type:"block",id:t.id,name:t.name}))}},this)}.bind(this))}if(i.test(this.content)){requestAnimationFrame(function(){var t=this.content.replace("#system_","");var e=BX.Landing.Main.getInstance().options.syspages;if(t in e){var i=e[t];this.setValue(this.createPlaceholder({type:"system",id:"_"+t,name:i.name}))}}.bind(this))}},onSelectButtonClick:function(){if(!this.popup){this.popup=BX.PopupMenu.create("link_list_"+ +new Date,this.button.layout,[{text:BX.message("LANDING_LINKS_BUTTON_LANDINGS"),onclick:this.onListShow.bind(this,"landings",this.options)},{text:BX.message("LANDING_LINKS_BUTTON_BLOCKS"),onclick:this.onListShow.bind(this,"blocks",this.options)}],{events:{onPopupClose:function(){this.button.layout.classList.remove("landing-ui-active");this.popup.destroy();this.popup=null}.bind(this)}});this.button.layout.parentNode.appendChild(this.popup.popupWindow.popupContainer)}this.button.layout.classList.add("landing-ui-active");this.popup.show();var t=BX.pos(this.button.layout,this.button.layout.parentNode);this.popup.popupWindow.popupContainer.style.top=t.bottom+"px";this.popup.popupWindow.popupContainer.style.left="auto";this.popup.popupWindow.popupContainer.style.right="0"},onListShow:function(t,e){BX.Landing.UI.Panel.URLList.getInstance().show(t,e).then(this.onListItemClick.bind(this))},isEditPrevented:function(){return this.editPrevented},enableEdit:function(){if(!this.isEditPrevented()&&!this.disableCustomURL){BX.Landing.UI.Field.Text.prototype.enableEdit.apply(this)}},createPlaceholder:function(t){return BX.create("span",{props:{className:"landing-ui-field-url-placeholder"},attrs:{"data-placeholder":["#",t.type,t.id].join("")},children:[BX.create("span",{props:{className:"landing-ui-field-url-placeholder-text"},text:t.name}),BX.create("span",{props:{className:"landing-ui-field-url-placeholder-delete"}})]})},onPlaceholderRemoveClick:function(t){this.editPrevented=false;this.enableEdit();BX.remove(t.target.parentNode);this.setValue("");BX.fireEvent(this.layout,"input");this.onInputHandler(this.input.innerText)},onListItemClick:function(t){this.setValue(this.createPlaceholder(t));BX.fireEvent(this.layout,"input")},onInputClick:function(t){BX.Landing.UI.Field.Text.prototype.onInputClick.apply(this,arguments);if(t.target.classList.contains("landing-ui-field-url-placeholder-delete")){this.onPlaceholderRemoveClick(t)}},adjustValue:function(){if(this.content.includes("tel:")){this.typeDropdown.setValue("tel:");this.input.innerText=this.input.innerText.replace("tel:","");return}if(this.content.includes("skype:")){this.typeDropdown.setValue("skype:");this.input.innerText=this.input.innerText.replace("skype:","");return}if(this.content.includes("sms:")){this.typeDropdown.setValue("sms:");this.input.innerText=this.input.innerText.replace("sms:","");return}if(this.content.includes("mailto:")){this.typeDropdown.setValue("mailto:");this.input.innerText=this.input.innerText.replace("mailto:","");return}this.typeDropdown.setValue("")},setValue:function(t){if(typeof t==="object"){this.disableEdit();this.editPrevented=true;this.input.innerHTML=t.outerHTML;this.value=t.dataset.placeholder;this.onInputHandler(this.input.innerText)}else{this.editPrevented=false;this.enableEdit();this.input.innerText=t.toString().trim();this.value=null}this.adjustValue()},getValue:function(){return this.typeDropdown.getValue()+(this.value?this.value:this.input.innerText)}}})();