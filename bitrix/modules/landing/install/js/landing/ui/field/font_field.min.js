(function(){"use strict";BX.namespace("BX.Landing.UI.Field");var n=BX.Landing.Utils.isFunction;var t=BX.Landing.Utils.isPlainObject;var e=BX.Landing.Utils.bind;var i=BX.Landing.Utils.proxy;var a=BX.Landing.Utils.escapeHtml;var s=BX.Landing.Utils.addClass;var o=BX.Landing.Utils.clone;BX.Landing.UI.Field.Font=function(o){BX.Landing.UI.Field.BaseField.apply(this,arguments);s(this.layout,"landing-ui-field-font");this.frame=o.frame;this.items=[];if(t(o.items)){var l=Object.keys(this.items);this.items=l.map(function(n){return{name:this.items[n],value:n}},this)}this.onChangeHandler=n(o.onChange)?o.onChange:function(){};this.onValueChangeHandler=n(o.onValueChange)?o.onValueChange:function(){};this.content=a(this.content);this.input.innerHTML=this.content;if(this.frame){var r=this.frame.document.querySelectorAll(this.selector)[0];if(r){var c=BX.style(r,"font-family");if(c){c=c.replace(/['|"]/g,"");this.content=c.split(",")[0];this.input.innerHTML=this.content}}}e(this.input,"click",i(this.onInputClick,this))};function l(n){return"g-font-"+n.toLowerCase().replace(/ /g,"-")}BX.Landing.UI.Field.Font.prototype={constructor:BX.Landing.UI.Field.Font,__proto__:BX.Landing.UI.Field.BaseField.prototype,onInputClick:function(n){n.preventDefault();n.stopPropagation();BX.Landing.UI.Panel.GoogleFonts.getInstance().show().then(function(n){if(!this.response){this.response=o(BX.Landing.UI.Panel.GoogleFonts.getInstance().response);this.response.forEach(function(n){this.items.push({name:n.family,value:l(n.family)})},this)}this.setValue(n)}.bind(this))},setValue:function(n){if(t(n)){var e=l(n.family);var i=BX.Landing.UI.Panel.GoogleFonts.getInstance().client.makeUrl({family:n.family.replace(/ /g,"+")});var s=BX.Landing.UI.Tool.FontManager.getInstance();s.addFont({className:e,family:n.family,href:i,category:n.category},window);this.input.innerHTML=a(n.family);this.onChangeHandler(e,this.items,this.postfix,this.property);this.onValueChangeHandler(this);s.removeUnusedFonts();var o="";s.getUsedLoadedFonts().forEach(function(n){if(n.element){o+=n.element.outerHTML+"\n"}if(n.CSSDeclaration){o+=n.CSSDeclaration.outerHTML}});o=o.replace("async@load","all");BX.Landing.Backend.getInstance().action("Landing::updateHead",{content:o})}}}})();